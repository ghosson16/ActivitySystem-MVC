@using ActivitySystem.Models.AccountVM
@model ProfileViewModel
@{
    ViewData["Title"] = "My Profile";
}


<div class="container py-5 mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-9">
            <div class="card custom-auth-card shadow-lg">

                <div class="dark-auth-section p-4 p-md-5 text-white d-flex flex-column flex-md-row align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <div class="avatar-circle-shared me-3">
                            <i class="bi bi-person"></i>
                        </div>
                        <div class="text-center text-md-start">
                            <h3 class="fw-bold mb-0">@Model.Name</h3>
                            <p class="small opacity-75 mb-0">Manage your personal information</p>
                        </div>
                    </div>

                    <div class="action-buttons mt-3 mt-md-0">
                        <button type="button" id="editBtn" class="btn btn-outline-light btn-sm rounded-pill px-3 fw-bold view-mode" onclick="enableEditing()">
                            <i class="bi bi-pencil me-1"></i> Edit Profile
                        </button>
                        <button type="button" class="btn btn-outline-danger btn-sm rounded-pill px-3 fw-bold view-mode ms-2" data-bs-toggle="modal" data-bs-target="#deleteModal">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>

                <div class="card-body p-4 p-md-5 bg-white">
                    <form asp-action="MyProfile" method="post">
                        @Html.AntiForgeryToken()
                        <div asp-validation-summary="ModelOnly" class="text-danger small"></div>

                        <div class="row g-4">
                            <div class="col-md-6">
                                <label asp-for="Name" class="extra-small fw-bold text-muted text-uppercase mb-1 d-block"></label>
                                <div class="view-mode py-2 border-bottom">
                                    <span class="fs-6 fw-semibold text-dark">@Model.Name</span>
                                </div>
                                <div class="edit-mode d-none custom-focus pb-1">
                                    <input asp-for="Name" class="form-control border-0 bg-transparent p-0 shadow-none" />
                                </div>
                                <span asp-validation-for="Name" class="text-danger extra-small"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="Email" class="extra-small fw-bold text-muted text-uppercase mb-1 d-block"></label>
                                <div class="py-2 border-bottom bg-light px-2 rounded-2">
                                    <span class="fs-6 text-muted">@Model.Email</span>
                                    <input asp-for="Email" class="d-none" readonly />
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="PhoneNumber" class="extra-small fw-bold text-muted text-uppercase mb-1 d-block"></label>
                                <div class="view-mode py-2 border-bottom">
                                    <span class="fs-6">@(Model.PhoneNumber ?? "Not set")</span>
                                </div>
                                <div class="edit-mode d-none custom-focus pb-1">
                                    <input asp-for="PhoneNumber" class="form-control border-0 bg-transparent p-0 shadow-none" placeholder="05xxxxxxxx" />
                                </div>
                            </div>

                            @if (User.IsInRole("Guest"))
                            {
                                <div class="col-md-6">
                                    <label asp-for="Age" class="extra-small fw-bold text-muted text-uppercase mb-1 d-block"></label>
                                    <div class="view-mode py-2 border-bottom">
                                        <span class="fs-6">@(Model.Age?.ToString() ?? "Not set")</span>
                                    </div>
                                    <div class="edit-mode d-none custom-focus pb-1">
                                        <input asp-for="Age" class="form-control border-0 bg-transparent p-0 shadow-none" />
                                    </div>
                                </div>
                            }

                            @if (User.IsInRole("Organizer"))
                            {
                                <div class="col-12">
                                    <label asp-for="Description" class="extra-small fw-bold text-muted text-uppercase mb-1 d-block"></label>
                                    <div class="view-mode py-2 border-bottom">
                                        <p class="fs-6 text-dark mb-0">@(Model.Description ?? "No description added")</p>
                                    </div>
                                    <div class="edit-mode d-none custom-focus pb-1">
                                        <textarea asp-for="Description" class="form-control border-0 bg-transparent p-0 shadow-none" rows="2" style="resize:none;"></textarea>
                                    </div>
                                </div>
                            }
                        </div>

                        <div class="edit-mode d-none mt-5 text-end">
                            <button type="button" class="btn btn-link text-muted me-3 text-decoration-none fw-bold" onclick="disableEditing()">Cancel</button>
                            <button type="submit" class="btn btn-dark px-5 rounded-pill fw-bold shadow-sm">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<partial name="_DeleteAccountPartial" />

@section Scripts {
    <script>
        function enableEditing() {
            document.querySelectorAll('.view-mode').forEach(el => el.classList.add('d-none'));
            document.querySelectorAll('.edit-mode').forEach(el => el.classList.remove('d-none'));
        }

        function disableEditing() {
            window.location.reload();
        }
    </script>
    <partial name="_ValidationScriptsPartial" />
}